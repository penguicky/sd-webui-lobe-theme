<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accordion Functionality Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .accordion {
            border: 1px solid #ddd;
            border-radius: 8px;
            margin: 10px 0;
            background: white;
        }
        
        .accordion-header {
            background: #f8f9fa;
            padding: 15px;
            cursor: pointer;
            border-bottom: 1px solid #ddd;
            font-weight: bold;
            user-select: none;
        }
        
        .accordion-header:hover {
            background: #e9ecef;
        }
        
        .accordion-content {
            padding: 20px;
            border-top: 1px solid #eee;
        }
        
        .hidden {
            display: none !important;
        }
        
        .forge-couple-container {
            background: #e7f3ff;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        
        .core-element {
            background: #f0f8f0;
            padding: 10px;
            margin: 5px 0;
            border: 1px solid #d4edda;
            border-radius: 4px;
        }
        
        .status {
            font-weight: bold;
            margin-left: 10px;
        }
        
        .visible { color: #28a745; }
        .hidden-status { color: #dc3545; }
        
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        
        button:hover {
            background: #0056b3;
        }
        
        .test-results {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>Accordion Functionality Test</h1>
    <p>This page tests that the compatibility fix respects Gradio's accordion .hidden class.</p>
    
    <div class="test-container">
        <h2>Simulated Forge Couple Accordion</h2>
        <p>Click the accordion header to expand/collapse. Content should hide/show properly:</p>
        
        <div class="accordion">
            <div class="accordion-header" onclick="toggleAccordion('forge_couple_t2i')">
                üîß Forge Couple (txt2img) - Click to Toggle
                <span class="status visible" id="status-t2i">‚úì EXPANDED</span>
            </div>
            <div class="accordion-content forge-couple-container" id="forge_couple_t2i">
                <h3>Forge Couple Extension Content</h3>
                <p>This simulates the forge-couple extension content that should be hidden when accordion is collapsed.</p>
                
                <div class="core-element fc_mapping">
                    <strong>.fc_mapping</strong> - Visual mapping container (protected)
                </div>
                
                <div class="core-element fc_mapping_btns">
                    <strong>.fc_mapping_btns</strong> - Mapping control buttons (protected)
                </div>
                
                <div class="core-element fc_bg_btns">
                    <strong>.fc_bg_btns</strong> - Background image buttons (protected)
                </div>
                
                <div class="core-element fc_preview_img">
                    <strong>.fc_preview_img</strong> - Preview image container (protected)
                </div>
                
                <div class="core-element fc_bbox">
                    <strong>.fc_bbox</strong> - Interactive bounding boxes (protected)
                </div>
            </div>
        </div>
        
        <div class="accordion">
            <div class="accordion-header" onclick="toggleAccordion('forge_couple_i2i')">
                üîß Forge Couple (img2img) - Click to Toggle
                <span class="status visible" id="status-i2i">‚úì EXPANDED</span>
            </div>
            <div class="accordion-content forge-couple-container" id="forge_couple_i2i">
                <h3>Forge Couple Extension Content (img2img)</h3>
                <p>This simulates the img2img version of the forge-couple extension.</p>
                
                <div class="core-element">
                    <strong>Mode Switching Test:</strong>
                    <button onclick="alert('Mode switching functionality preserved!')">Basic</button>
                    <button onclick="alert('Mode switching functionality preserved!')">Advanced</button>
                    <button onclick="alert('Mode switching functionality preserved!')">Mask</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="test-container">
        <h2>Test Controls</h2>
        <button onclick="testCompatibility()">Test Compatibility Protection</button>
        <button onclick="testAccordionState()">Test Accordion State</button>
        <button onclick="resetTest()">Reset Test</button>
        
        <div class="test-results" id="test-results">
            <p><strong>Ready:</strong> Click buttons above to test functionality.</p>
        </div>
    </div>
    
    <div class="test-container">
        <h2>Expected Behavior</h2>
        <ul>
            <li>‚úÖ Accordion headers should expand/collapse content when clicked</li>
            <li>‚úÖ Content should be completely hidden when accordion is collapsed (.hidden class)</li>
            <li>‚úÖ Content should be visible when accordion is expanded</li>
            <li>‚úÖ Core elements should remain protected from other hiding mechanisms</li>
            <li>‚úÖ Compatibility script should respect .hidden class and not interfere</li>
        </ul>
    </div>
    
    <script>
        function toggleAccordion(id) {
            const content = document.getElementById(id);
            const status = document.getElementById(`status-${id.includes('t2i') ? 't2i' : 'i2i'}`);
            
            if (content.classList.contains('hidden')) {
                // Expand
                content.classList.remove('hidden');
                status.textContent = '‚úì EXPANDED';
                status.className = 'status visible';
                console.log(`[Accordion Test] Expanded ${id}`);
            } else {
                // Collapse
                content.classList.add('hidden');
                status.textContent = '‚úó COLLAPSED';
                status.className = 'status hidden-status';
                console.log(`[Accordion Test] Collapsed ${id}`);
            }
        }
        
        function testCompatibility() {
            const results = document.getElementById('test-results');
            const testElement = document.querySelector('.fc_mapping');
            
            if (!testElement) {
                results.innerHTML = '<p><strong>‚ùå ERROR:</strong> Test element not found.</p>';
                return;
            }
            
            // Try to hide the element directly
            testElement.style.display = 'none';
            
            setTimeout(() => {
                const isStillHidden = testElement.style.display === 'none';
                const parentHidden = testElement.closest('.hidden') !== null;
                
                if (parentHidden) {
                    results.innerHTML = `
                        <p><strong>‚úÖ SUCCESS:</strong> Compatibility respects accordion state!</p>
                        <p>Element is in collapsed accordion and compatibility script is not interfering.</p>
                    `;
                } else if (isStillHidden) {
                    results.innerHTML = `
                        <p><strong>‚ö† WARNING:</strong> Element protection may not be working.</p>
                        <p>Element was hidden and not restored (but this might be expected if accordion is collapsed).</p>
                    `;
                } else {
                    results.innerHTML = `
                        <p><strong>‚úÖ SUCCESS:</strong> Element protection is working!</p>
                        <p>Element was automatically restored when hidden.</p>
                    `;
                }
            }, 100);
        }
        
        function testAccordionState() {
            const results = document.getElementById('test-results');
            const t2iContent = document.getElementById('forge_couple_t2i');
            const i2iContent = document.getElementById('forge_couple_i2i');
            
            const t2iHidden = t2iContent.classList.contains('hidden');
            const i2iHidden = i2iContent.classList.contains('hidden');
            
            results.innerHTML = `
                <p><strong>Accordion State Test:</strong></p>
                <p>txt2img accordion: ${t2iHidden ? '‚úó COLLAPSED' : '‚úì EXPANDED'}</p>
                <p>img2img accordion: ${i2iHidden ? '‚úó COLLAPSED' : '‚úì EXPANDED'}</p>
                <p><em>Both accordions should respond to header clicks independently.</em></p>
            `;
        }
        
        function resetTest() {
            // Expand both accordions
            document.getElementById('forge_couple_t2i').classList.remove('hidden');
            document.getElementById('forge_couple_i2i').classList.remove('hidden');
            
            // Reset status indicators
            document.getElementById('status-t2i').textContent = '‚úì EXPANDED';
            document.getElementById('status-t2i').className = 'status visible';
            document.getElementById('status-i2i').textContent = '‚úì EXPANDED';
            document.getElementById('status-i2i').className = 'status visible';
            
            // Reset test results
            document.getElementById('test-results').innerHTML = '<p><strong>Reset:</strong> Both accordions expanded. Ready for testing.</p>';
            
            console.log('[Accordion Test] Reset complete');
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            console.log('[Accordion Test] Page loaded - ready for testing');
        });
    </script>
</body>
</html>
